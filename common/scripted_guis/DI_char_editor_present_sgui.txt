### Add All Lifestyle Perks
DI_ce_add_all_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_martial_present_effect = yes
				lifestyle_diplomacy_present_effect = yes
				lifestyle_stewardship_present_effect = yes
				lifestyle_intrigue_present_effect = yes
				lifestyle_learning_present_effect = yes
				lifestyle_wandering_present_effect = yes
			}
		}
		else = { 
			lifestyle_martial_present_effect = yes
			lifestyle_diplomacy_present_effect = yes
			lifestyle_stewardship_present_effect = yes
			lifestyle_intrigue_present_effect = yes
			lifestyle_learning_present_effect = yes
			lifestyle_wandering_present_effect = yes
		}
	}
}

### Remove All Lifestyle Perks
DI_ce_remove_all_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_martial_present_no_effect = yes
				lifestyle_diplomacy_present_no_effect = yes
				lifestyle_stewardship_present_no_effect = yes
				lifestyle_intrigue_present_no_effect = yes
				lifestyle_learning_present_no_effect = yes
				lifestyle_wandering_present_no_effect = yes
			}
		}
		else = {
			lifestyle_martial_present_no_effect = yes
			lifestyle_diplomacy_present_no_effect = yes
			lifestyle_stewardship_present_no_effect = yes
			lifestyle_intrigue_present_no_effect = yes
			lifestyle_learning_present_no_effect = yes
			lifestyle_wandering_present_no_effect = yes
		}
	}
}

### Add All Martial Lifestyle Perks
DI_ce_add_martial_lifestyle = {
	scope = character
	
	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_martial_present_effect = yes
			}
		}
		else = {
			lifestyle_martial_present_effect = yes
		}
	}
}

### Remove All Martial Lifestyle Perks
DI_ce_remove_martial_lifestyle = {
	scope = character
	
	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_martial_present_no_effect = yes
			}
		}
		else = {
			lifestyle_martial_present_no_effect = yes
		}
	}
}

### Add All Diplomacy Lifestyle Perks
DI_ce_add_diplomacy_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_diplomacy_present_effect = yes
			}
		}
		else = {
			lifestyle_diplomacy_present_effect = yes
		}
	}
}

### Remove All Diplomacy Lifestyle Perks
DI_ce_remove_diplomacy_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_diplomacy_present_no_effect = yes
			}
		}
		else = {
			lifestyle_diplomacy_present_no_effect = yes
		}
	}
}

### Add All stewardship Lifestyle Perks
DI_ce_add_stewardship_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_stewardship_present_effect = yes
			}
		}
		else = {
			lifestyle_stewardship_present_effect = yes
		}
	}
}

### Remove All stewardship Lifestyle Perks
DI_ce_remove_stewardship_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_stewardship_present_no_effect = yes
			}
		}
		else = {
			lifestyle_stewardship_present_no_effect = yes
		}
	}
}

### Add All intrigue Lifestyle Perks
DI_ce_add_intrigue_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_intrigue_present_effect = yes
			}
		}
		else = {
			lifestyle_intrigue_present_effect = yes
		}
	}
}

### Remove All intrigue Lifestyle Perks
DI_ce_remove_intrigue_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_intrigue_present_no_effect = yes
			}
		}
		else = {
			lifestyle_intrigue_present_no_effect = yes
		}
	}
}

### Add All learning Lifestyle Perks
DI_ce_add_learning_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				lifestyle_learning_present_effect = yes
			}
		}
		else = {
			lifestyle_learning_present_effect = yes
		}
	}
}

### Remove All learning Lifestyle Perks
DI_ce_remove_learning_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = { 
					has_character_flag = pinned_for_edit
				}
				lifestyle_learning_present_no_effect = yes
			}
		}
		else = {
			lifestyle_learning_present_no_effect = yes
		}
	}
}

### Add All Wandering Lifestyle Perks
DI_ce_add_wandering_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = { 
					has_character_flag = pinned_for_edit
				}
				lifestyle_wandering_present_effect = yes
			}
		}
		else = {
			lifestyle_wandering_present_effect = yes
		}
	}
}

### Remove All Wandering Lifestyle Perks
DI_ce_remove_wandering_lifestyle = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = { 
					has_character_flag = pinned_for_edit
				}
				lifestyle_wandering_present_no_effect = yes
			}
		}
		else = {
			lifestyle_wandering_present_no_effect = yes
		}
	}
}

### Eliminate Health Issues
DI_ce_eliminate_health_issues = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
			set_weight_0 = yes
			eliminated_health_problem_effect = yes
			}
		}
		else = {
			set_weight_0 = yes
			eliminated_health_problem_effect = yes
		}
	}
}

### Add Good Health Genes
DI_ce_add_good_genes = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_health_conflict_effect = yes

				add_trait = physique_good_3
				add_trait = intellect_good_3
				add_trait = beauty_good_3
				add_trait = pure_blooded
				add_trait = fecund
			}
		}
		else = {
			remove_health_conflict_effect = yes
			add_trait = physique_good_3
			add_trait = intellect_good_3
			add_trait = beauty_good_3
			add_trait = pure_blooded
			add_trait = fecund
		}
	}
}

### Remove Good Health Genes
DI_ce_remove_good_genes = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}

				remove_trait = physique_good_3
				remove_trait = intellect_good_3
				remove_trait = beauty_good_3
				remove_trait = pure_blooded
				remove_trait = fecund
			}
		}
		else = {
			remove_trait = physique_good_3
			remove_trait = intellect_good_3
			remove_trait = beauty_good_3
			remove_trait = pure_blooded
			remove_trait = fecund
		}
	}
}

### Add Bad Health Traits
DI_ce_add_bad_genes = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_health_conflict_forbadgene_effect = yes
				remove_trait = physique_good_3
				remove_trait = intellect_good_3
				remove_trait = beauty_good_3
				remove_trait = pure_blooded
				remove_trait = fecund
				add_trait = beauty_bad_3
				add_trait = intellect_bad_3
				add_trait = physique_bad_3
				add_trait = inbred
				add_trait = impotent
			}
		}
		else = {
			remove_health_conflict_forbadgene_effect = yes
			remove_trait = physique_good_3
			remove_trait = intellect_good_3
			remove_trait = beauty_good_3
			remove_trait = pure_blooded
			remove_trait = fecund
			add_trait = beauty_bad_3
			add_trait = intellect_bad_3
			add_trait = physique_bad_3
			add_trait = inbred
			add_trait = impotent
		}
	}
}

### Remove Bad Health Traits
DI_ce_remove_bad_genes = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = { 
					has_character_flag = pinned_for_edit
				}
				remove_trait = beauty_bad_3
				remove_trait = intellect_bad_3
				remove_trait = physique_bad_3
				remove_trait = inbred
				remove_trait = impotent
			}
		}
		else = {
			remove_trait = beauty_bad_3
			remove_trait = intellect_bad_3
			remove_trait = physique_bad_3
			remove_trait = inbred
			remove_trait = impotent
		}
	}
}

### No stress change
DI_ce_lock_stress = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				add_character_modifier = no_stress_change 
			}
		}
		else = {
			add_character_modifier = no_stress_change
		}
	}
}

DI_ce_unlock_stress = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_character_modifier = no_stress_change 
			}
		}
		else = {
			remove_character_modifier = no_stress_change
		}
	}
}

### No tyranny change
DI_ce_lock_tyranny = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				add_character_modifier = no_tyranny_change 
			}
		}
		else = {
			add_character_modifier = no_tyranny_change
		}
	}
}

DI_ce_unlock_tyranny = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_character_modifier = no_tyranny_change 
			}
		}
		else = {
			remove_character_modifier = no_tyranny_change
		}
	}
}

### No dread change
DI_ce_lock_dread = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				add_character_modifier = no_dread_change 
			}
		}
		else = {
			add_character_modifier = no_dread_change
		}
	}
}

DI_ce_unlock_dread = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_character_modifier = no_dread_change 
			}
		}
		else = {
			remove_character_modifier = no_dread_change
		}
	}
}

### Randomize Three Personality Traits
DI_ce_randomize_personality = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				clear_personality_traits_effect = yes
				personality_trait_randomizer_effect = yes
			}
		}
		else = {
			clear_personality_traits_effect = yes
			personality_trait_randomizer_effect = yes
		}
	}
}

### Remove Personality Traits
DI_ce_clear_personality = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				clear_personality_traits_effect = yes
			}
		}
		else = {
			clear_personality_traits_effect = yes
		}
	}

}

### Add Special Mod Traits
DI_ce_add_special_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				add_trait = DI_immortal
				set_immortal_age = 30
				add_trait = 100_stat_man
				add_trait = nnn_challenger
				add_trait = build_speed_cheat
				add_trait = stress_gain_remove
				add_trait = tyranny_gain_remove
			}
		}
		else = {
			add_trait = DI_immortal
			set_immortal_age = 30
			add_trait = 100_stat_man
			add_trait = nnn_challenger
			add_trait = build_speed_cheat
			add_trait = stress_gain_remove
			add_trait = tyranny_gain_remove
		}
	}
}

### Remove Special Mod Traits
DI_ce_remove_special_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = DI_immortal
				remove_trait = 100_stat_man
				remove_trait = nnn_challenger
				remove_trait = build_speed_cheat
				remove_trait = stress_gain_remove
				remove_trait = tyranny_gain_remove
			}
		}
		else = {
			remove_trait = DI_immortal
			remove_trait = 100_stat_man
			remove_trait = nnn_challenger
			remove_trait = build_speed_cheat
			remove_trait = stress_gain_remove
			remove_trait = tyranny_gain_remove
		}
	}
}

### Add All Commander Traits
DI_ce_add_commander_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				add_commander_traits_effect = yes
			}
		}
		else = {
			add_commander_traits_effect = yes
		}
	}
}

### Remove All Commander Traits
DI_ce_remove_commander_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_commander_traits_effect = yes
			}
		}
		else = {
			remove_commander_traits_effect = yes
		}
	}
}

### Aggressive Traits
DI_ce_add_aggressive_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				clear_personality_traits_effect = yes
				add_trait = wrathful
				add_trait = brave
				add_trait = vengeful
			}
		}
		else = {
			clear_personality_traits_effect = yes
			add_trait = wrathful
			add_trait = brave
			add_trait = vengeful
		
		}
	}
}

DI_ce_remove_aggressive_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = wrathful
				remove_trait = brave
				remove_trait = vengeful
			}
		}
		else = {
			remove_trait = wrathful
			remove_trait = brave
			remove_trait = vengeful
		}
	}
}

### Timid Traits 
DI_ce_add_timid_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				clear_personality_traits_effect = yes
				add_trait = shy
				add_trait = craven
				add_trait = forgiving
			}
		}
		else = {
			clear_personality_traits_effect = yes
			add_trait = shy
			add_trait = craven
			add_trait = forgiving
		}
	}
}

DI_ce_remove_timid_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = shy
				remove_trait = craven
				remove_trait = forgiving
			}
		}
		else = {
			remove_trait = shy
			remove_trait = craven
			remove_trait = forgiving
		}
	}
}

### Add Character traits that make the character a giant
DI_ce_add_giant_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = dwarf
				remove_trait = physique_good_1
				remove_trait = physique_good_2
				remove_trait = physique_bad_1
				remove_trait = physique_bad_2
				remove_trait = physique_bad_3
				change_current_weight = 100
				add_trait = physique_good_3
				add_trait = giant
			}
		}
		else = {
			remove_trait = dwarf
			remove_trait = physique_good_1
			remove_trait = physique_good_2
			remove_trait = physique_bad_1
			remove_trait = physique_bad_2
			remove_trait = physique_bad_3
			change_current_weight = 100
			add_trait = physique_good_3
			add_trait = giant
		}
	}
}

### Remove Traits Giant
DI_ce_remove_giant_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				set_weight_0 = yes
				remove_trait = physique_good_3
				remove_trait = giant
			}
		}
		else = {
			set_weight_0 = yes
			remove_trait = physique_good_3
			remove_trait = giant
		}
	}
}

### Add Character traits that make the character a midget
DI_ce_add_dwarf_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = giant
				remove_trait = physique_good_1
				remove_trait = physique_good_2
				remove_trait = physique_good_3
				remove_trait = physique_bad_1
				remove_trait = physique_bad_2
				change_current_weight = 0
				add_trait = physique_bad_3
				add_trait = dwarf
			}
		}
		else = {
			remove_trait = giant
			remove_trait = physique_good_1
			remove_trait = physique_good_2
			remove_trait = physique_good_3
			remove_trait = physique_bad_1
			remove_trait = physique_bad_2
			change_current_weight = 0
			add_trait = physique_bad_3
			add_trait = dwarf
		}
	}
}

### Remove Traits Midget
DI_ce_remove_dwarf_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = physique_bad_3
				remove_trait = dwarf
			}
		}
		else = {
			remove_trait = physique_bad_3
			remove_trait = dwarf
		}
	}
}

### Add Character traits that make the character ghostly
DI_ce_add_albino_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				change_current_weight = 0
				add_trait = albino
				add_trait = spindly
			}
		}
		else = {
			change_current_weight = 0
			add_trait = albino
			add_trait = spindly
		}
	}
}

### Remove Traits Ghostly
DI_ce_remove_albino_traits = {
	scope = character

	effect = {
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				remove_trait = albino
				remove_trait = spindly
			}
		}
		else = {
			remove_trait = albino
			remove_trait = spindly
		}
	}
}

### Present Innovation Remove All Innovations
DI_present_remove_all_innovations = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target

				scope:target.culture = {
					innovation_remove_all_effect = yes
				}
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_remove_all_effect = yes
			}
		}
	}
}

### Present Innovation Add All Regional Innovations
DI_present_innovation_regional = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target

				scope:target.culture = {
					innovation_tribal_regional_effect = yes
					innovation_early_medieval_regional_effect = yes
					innovation_high_medieval_regional_effect = yes
					innovation_late_medieval_regional_effect = yes
				}
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_tribal_regional_effect = yes
				innovation_early_medieval_regional_effect = yes
				innovation_high_medieval_regional_effect = yes
				innovation_late_medieval_regional_effect = yes
			}
		}
	}
}

### Present Innovation Add All Local Innovations
DI_present_innovation_local = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_tribal_effect = yes
					innovation_early_medieval_effect = yes
					innovation_high_medieval_effect = yes
					innovation_late_medieval_effect = yes
				}
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_tribal_effect = yes
				innovation_early_medieval_effect = yes
				innovation_high_medieval_effect = yes
				innovation_late_medieval_effect = yes
			}
		}
	}
}

### Add Regional Tribal Innovations
DI_present_innovation_regional_tribal = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_tribal_regional_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_tribal_regional_effect = yes
			}
		}
	}
}

### Add Regional Early Medieval Innovations
DI_present_innovation_regional_early = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_early_medieval_regional_effect = yes		
				}
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_early_medieval_regional_effect = yes
			}
		}
	}
}

### Add Regional High Medieval Innovations
DI_present_innovation_regional_high = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_high_medieval_regional_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_high_medieval_regional_effect = yes
			}
		}
	}
}

### Add Regional Late Medieval Innovations
DI_present_innovation_regional_late = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_late_medieval_regional_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_late_medieval_regional_effect = yes
			}
		}
	}
}

### Add All Local Tribal Innovations
DI_present_innovation_tribal = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_tribal_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_tribal_effect = yes
			}
		}
	}
}

### Add All Local Early Medieval Innovations
DI_present_innovation_early = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_early_medieval_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_early_medieval_effect = yes
			}
		}
	}
}

### Add All Local High Medieval Innovations
DI_present_innovation_high = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_high_medieval_effect = yes	
				}	
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_high_medieval_effect = yes
			}
		}
	}
}

### Add All Local Late Medieval Innovations
DI_present_innovation_late = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					innovation_late_medieval_effect = yes
				}		
			}
		}
		else = {
			scope:root_target.culture = {
				innovation_late_medieval_effect = yes
			}
		}
	}
}

### Tribal Innovations
### Table of Princes
DI_present_innovation_table_of_princes = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_table_of_princes
							}
						}
						add_innovation = innovation_table_of_princes
					}
					else = {
						remove_innovation = innovation_table_of_princes
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_table_of_princes
						}
					}
					add_innovation = innovation_table_of_princes
				}
				else = {
					remove_innovation = innovation_table_of_princes
				}
			}
		}
	}
}

### Longboats
DI_present_innovation_longboats = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_longboats
							}
						}
						add_innovation = innovation_longboats
					}
					else = {
						remove_innovation = innovation_longboats
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_longboats
						}
					}
					add_innovation = innovation_longboats
				}
				else = {
					remove_innovation = innovation_longboats
				}
			}
		}
	}
}

### elephantry
DI_present_innovation_elephantry = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_elephantry
							}
						}
						add_innovation = innovation_elephantry
					}
					else = {
						remove_innovation = innovation_elephantry
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_elephantry
						}
					}
					add_innovation = innovation_elephantry
				}
				else = {
					remove_innovation = innovation_elephantry
				}
			}
		}
	}
}

### war camels
DI_present_innovation_war_camels = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_war_camels
							}
						}
						add_innovation = innovation_war_camels
					}
					else = {
						remove_innovation = innovation_war_camels
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_war_camels
						}
					}
					add_innovation = innovation_war_camels
				}
				else = {
					remove_innovation = innovation_war_camels
				}
			}
		}
	}
}

### wootz steel
DI_present_innovation_wootz_steel = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_wootz_steel
							}
						}
						add_innovation = innovation_wootz_steel
					}
					else = {
						remove_innovation = innovation_wootz_steel
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_wootz_steel
						}
					}
					add_innovation = innovation_wootz_steel
				}
				else = {
					remove_innovation = innovation_wootz_steel
				}
			}
		}
	}
}

### African Canoes
DI_present_innovation_african_canoes = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_african_canoes
							}
						}
						add_innovation = innovation_african_canoes
					}
					else = {
						remove_innovation = innovation_african_canoes
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_african_canoes
						}
					}
					add_innovation = innovation_african_canoes
				}
				else = {
					remove_innovation = innovation_african_canoes
				}
			}
		}
	}
}

### caballeros
DI_present_innovation_caballeros = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_caballeros
							}
						}
						add_innovation = innovation_caballeros
					}
					else = {
						remove_innovation = innovation_caballeros
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_caballeros
						}
					}
					add_innovation = innovation_caballeros
				}
				else = {
					remove_innovation = innovation_caballeros
				}
			}
		}
	}
}

### Bamboo Bows
DI_present_innovation_bamboo_bows = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_bamboo_bows
							}
						}
						add_innovation = innovation_bamboo_bows
					}
					else = {
						remove_innovation = innovation_bamboo_bows
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_bamboo_bows
						}
					}
					add_innovation = innovation_bamboo_bows
				}
				else = {
					remove_innovation = innovation_bamboo_bows
				}
			}
		}
	}
}

### Sahel Horsemen
DI_present_innovation_sahel_horsemen = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_sahel_horsemen
							}
						}
						add_innovation = innovation_sahel_horsemen
					}
					else = {
						remove_innovation = innovation_sahel_horsemen
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_sahel_horsemen
						}
					}
					add_innovation = innovation_sahel_horsemen
				}
				else = {
					remove_innovation = innovation_sahel_horsemen
				}
			}
		}
	}
}

### Varangian Adventurers
DI_present_innovation_varangian_adventurers = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							AND = {
								NOT = {
									has_innovation = innovation_varangian_adventurers
								}
								has_fp1_dlc_trigger = yes
							}
							
						}
						add_innovation = innovation_varangian_adventurers
					}
					else_if = {
						limit = {
							has_fp1_dlc_trigger = yes
						}
						remove_innovation = innovation_varangian_adventurers
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						AND = {
							NOT = {
								has_innovation = innovation_varangian_adventurers
							}
							has_fp1_dlc_trigger = yes
						}
					}
					add_innovation = innovation_varangian_adventurers
				}
				else_if = {
					limit = {
						has_fp1_dlc_trigger = yes
					}
					remove_innovation = innovation_varangian_adventurers
				}
			}
		}
	}
}

### All Things
DI_present_innovation_all_things = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							AND = {
								NOT = {
									has_innovation = innovation_all_things
								}
								has_fp1_dlc_trigger = yes
							}
						}
						add_innovation = innovation_all_things
					}
					else_if = {
						limit = {
							has_fp1_dlc_trigger = yes
						}
						remove_innovation = innovation_all_things
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						AND = {
							NOT = {
								has_innovation = innovation_all_things
							}
							has_fp1_dlc_trigger = yes
						}
					}
					add_innovation = innovation_all_things
				}
				else_if = {
					limit = {
						has_fp1_dlc_trigger = yes
					}
					remove_innovation = innovation_all_things
				}
			}
		}
	}
}

### Repeating Crossbow
DI_present_innovation_repeating_crossbow = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_repeating_crossbow
							}
						}
						add_innovation = innovation_repeating_crossbow
					}
					else = {
						remove_innovation = innovation_repeating_crossbow
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_repeating_crossbow
						}
					}
					add_innovation = innovation_repeating_crossbow
				}
				else = {
					remove_innovation = innovation_repeating_crossbow
				}
			}
		}
	}
}

### Pole Vault
DI_present_innovation_pole_vault = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_pole_vault
							}
						}
						add_innovation = innovation_pole_vault
					}
					else = {
						remove_innovation = innovation_pole_vault
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_pole_vault
						}
					}
					add_innovation = innovation_pole_vault
				}
				else = {
					remove_innovation = innovation_pole_vault
				}
			}
		}
	}
}

### Early Medieval Innovations
### Reconquista
DI_present_innovation_reconquista = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_reconquista
							}
						}
						add_innovation = innovation_reconquista
					}
					else = {
						remove_innovation = innovation_reconquista
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_reconquista
						}
					}
					add_innovation = innovation_reconquista
				}
				else = {
					remove_innovation = innovation_reconquista
				}
			}
		}
	}
}

### Stem Duchies
DI_present_innovation_stem_duchies= {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_stem_duchies
							}
						}
						add_innovation = innovation_stem_duchies
					}
					else = {
						remove_innovation = innovation_stem_duchies
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_stem_duchies
						}
					}
					add_innovation = innovation_stem_duchies
				}
				else = {
					remove_innovation = innovation_stem_duchies
				}
			}
		}
	}
}

### Ghilman
DI_present_innovation_ghilman = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_ghilman
							}
						}
						add_innovation = innovation_ghilman
					}
					else = {
						remove_innovation = innovation_ghilman
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_ghilman
						}
					}
					add_innovation = innovation_ghilman
				}
				else = {
					remove_innovation = innovation_ghilman
				}
			}
		}
	}
}

### High Medieval Innovations
### East Settling
DI_present_innovation_east_settling = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_east_settling
							}
						}
						add_innovation = innovation_east_settling
					}
					else = {
						remove_innovation = innovation_east_settling
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = { 
						NOT = {
							has_innovation = innovation_east_settling
						}
					}
					add_innovation = innovation_east_settling
				}
				else = {
					remove_innovation = innovation_east_settling
				}
			}
		}
	}
}

### Seigneurialism
DI_present_innovation_seigneurialism = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_seigneurialism
							}
						}
						add_innovation = innovation_seigneurialism
					}
					else = {
						remove_innovation = innovation_seigneurialism
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_seigneurialism
						}
					}
					add_innovation = innovation_seigneurialism
				}
				else = {
					remove_innovation = innovation_seigneurialism
				}
			}
		}
	}
}

### Muladi
DI_present_innovation_muladi = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_muladi
							}
						}
						add_innovation = innovation_muladi
					}
					else = {
						remove_innovation = innovation_muladi
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_muladi
						}
					}
					add_innovation = innovation_muladi
				}
				else = {
					remove_innovation = innovation_muladi
				}
			}
		}
	}
}

### French Peerage
DI_present_innovation_french_peerage = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_french_peerage
							}
						}
						add_innovation = innovation_french_peerage
					}
					else = {
						remove_innovation = innovation_french_peerage
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_french_peerage
						}
					}
					add_innovation = innovation_french_peerage
				}
				else = {
					remove_innovation = innovation_french_peerage
				}
			}
		}
	}
}

### Hobbies
DI_present_innovation_hobbies = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_hobbies
							}
						}
						add_innovation = innovation_hobbies
					}
					else = {
						remove_innovation = innovation_hobbies
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_hobbies
						}
					}
					add_innovation = innovation_hobbies
				}
				else = {
					remove_innovation = innovation_hobbies
				}
			}
		}
	}
}

### Pike Columns
DI_present_innovation_pike_columns = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_pike_columns
							}
						}
						add_innovation = innovation_pike_columns
					}
					else = {
						remove_innovation = innovation_pike_columns
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_pike_columns
						}
					}
					add_innovation = innovation_pike_columns
				}
				else = {
					remove_innovation = innovation_pike_columns
				}
			}
		}
	}
}

### Desert Tactics
DI_present_innovation_desert_tactics = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_desert_tactics
							}
						}
						add_innovation = innovation_desert_tactics
					}
					else = {
						remove_innovation = innovation_desert_tactics
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_desert_tactics
						}
					}
					add_innovation = innovation_desert_tactics
				}
				else = {
					remove_innovation = innovation_desert_tactics
				}
			}
		}
	}
}

### Sarawit
DI_present_innovation_sarawit = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_sarawit
							}
						}
						add_innovation = innovation_sarawit
					}
					else = {
						remove_innovation = innovation_sarawit
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_sarawit
						}
					}
					add_innovation = innovation_sarawit
				}
				else = {
					remove_innovation = innovation_sarawit
				}
			}
		}
	}
}

### Late Medieval Innovations
### Wierdijks
DI_present_innovation_wierdijks = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_wierdijks
							}
						}
						add_innovation = innovation_wierdijks
					}
					else = {
						remove_innovation = innovation_wierdijks
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_wierdijks
						}
					}
					add_innovation = innovation_wierdijks
				}
				else = {
					remove_innovation = innovation_wierdijks
				}
			}
		}
	}
}

### Condottieri
DI_present_innovation_condottieri = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_condottieri
							}
						}
						add_innovation = innovation_condottieri
					}
					else = {
						remove_innovation = innovation_condottieri
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_condottieri
						}
					}
					add_innovation = innovation_condottieri
				}
				else = {
					remove_innovation = innovation_condottieri
				}
			}
		}
	}
}

### Deccan Unity
DI_present_innovation_deccan_unity = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_deccan_unity
							}
						}
						add_innovation = innovation_deccan_unity
					}
					else = {
						remove_innovation = innovation_deccan_unity
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_deccan_unity
						}
					}
					add_innovation = innovation_deccan_unity
				}
				else = {
					remove_innovation = innovation_deccan_unity
				}
			}
		}
	}
}

### Valets
DI_present_innovation_valets = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_valets
							}
						}
						add_innovation = innovation_valets
					}
					else = {
						remove_innovation = innovation_valets
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_valets
						}
					}
					add_innovation = innovation_valets
				}
				else = {
					remove_innovation = innovation_valets
				}
			}
		}
	}
}

### Zweihanders
DI_present_innovation_zweihanders = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_zweihanders
							}
						}
						add_innovation = innovation_zweihanders
					}
					else = {
						remove_innovation = innovation_zweihanders
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_zweihanders
						}
					}
					add_innovation = innovation_zweihanders
				}
				else = {
					remove_innovation = innovation_zweihanders
				}
			}
		}
	}
}

### Adaptive Militia
DI_present_innovation_adaptive_militia = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_adaptive_militia
							}
						}
						add_innovation = innovation_adaptive_militia
					}
					else = {
						remove_innovation = innovation_adaptive_militia
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_adaptive_militia
						}
					}
					add_innovation = innovation_adaptive_militia
				}
				else = {
					remove_innovation = innovation_adaptive_militia
				}
			}
		}
	}
}

### Legionnaires
DI_present_innovation_legionnaires = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_legionnaires
							}
						}
						add_innovation = innovation_legionnaires
					}
					else = {
						remove_innovation = innovation_legionnaires
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_legionnaires
						}
					}
					add_innovation = innovation_legionnaires
				}
				else = {
					remove_innovation = innovation_legionnaires
				}
			}
		}
	}
}

### Rectilinear Schiltron
DI_present_innovation_rectilinear_schiltron = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_rectilinear_schiltron
							}
						}
						add_innovation = innovation_rectilinear_schiltron
					}
					else = {
						remove_innovation = innovation_rectilinear_schiltron
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_rectilinear_schiltron
						}
					}
					add_innovation = innovation_rectilinear_schiltron
				}
				else = {
					remove_innovation = innovation_rectilinear_schiltron
				}
			}
		}
	}
}

### Tribal Local Innovations
### Mottes
DI_present_innovation_motte = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_motte
							}
						}
						add_innovation = innovation_motte
					}
					else = {
						remove_innovation = innovation_motte
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_motte
						}
					}
					add_innovation = innovation_motte
				}
				else = {
					remove_innovation = innovation_motte
				}		
			}
		}
	}
}

### Catapult
DI_present_innovation_catapult = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_catapult
							}
						}
						add_innovation = innovation_catapult
					}
					else = {
						remove_innovation = innovation_catapult
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_catapult
						}
					}
					add_innovation = innovation_catapult
				}
				else = {
					remove_innovation = innovation_catapult
				}		
			}
		}
	}
}

### Barracks
DI_present_innovation_barracks = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_barracks
							}
						}
						add_innovation = innovation_barracks
					}
					else = {
						remove_innovation = innovation_barracks
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_barracks
						}
					}
					add_innovation = innovation_barracks
				}
				else = {
					remove_innovation = innovation_barracks
				}		
			}
		}
	}
}

### Mustering Grounds
DI_present_innovation_mustering_grounds = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_mustering_grounds
							}
						}
						add_innovation = innovation_mustering_grounds
					}
					else = {
						remove_innovation = innovation_mustering_grounds
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_mustering_grounds
						}
					}
					add_innovation = innovation_mustering_grounds
				}
				else = {
					remove_innovation = innovation_mustering_grounds
				}		
			}
		}
	}
}

### Bannus
DI_present_innovation_bannus = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_bannus
							}
						}
						add_innovation = innovation_bannus
					}
					else = {
						remove_innovation = innovation_bannus
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_bannus
						}
					}
					add_innovation = innovation_bannus
				}
				else = {
					remove_innovation = innovation_bannus
				}		
			}
		}
	}
}

### Quilted Armor
DI_present_innovation_quilted_armor = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_quilted_armor
							}
						}
						add_innovation = innovation_quilted_armor
					}
					else = {
						remove_innovation = innovation_quilted_armor
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_quilted_armor
						}
					}
					add_innovation = innovation_quilted_armor
				}
				else = {
					remove_innovation = innovation_quilted_armor
				}		
			}
		}
	}
}

### Public Works
DI_present_innovation_development_01 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_development_01
							}
						}
						add_innovation = innovation_development_01
					}
					else = {
						remove_innovation = innovation_development_01
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_development_01
						}
					}
					add_innovation = innovation_development_01
				}
				else = {
					remove_innovation = innovation_development_01
				}		
			}
		}
	}
}

### Currency
DI_present_innovation_currency_01 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_currency_01
							}
						}
						add_innovation = innovation_currency_01
					}
					else = {
						remove_innovation = innovation_currency_01
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_currency_01
						}
					}
					add_innovation = innovation_currency_01
				}
				else = {
					remove_innovation = innovation_currency_01
				}		
			}
		}
	}
}

### Gavelkind
DI_present_innovation_gavelkind = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_gavelkind
							}
						}
						add_innovation = innovation_gavelkind
					}
					else = {
						remove_innovation = innovation_gavelkind
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_gavelkind
						}
					}
					add_innovation = innovation_gavelkind
				}
				else = {
					remove_innovation = innovation_gavelkind
				}		
			}
		}
	}
}

### Crop Rotation
DI_present_innovation_crop_rotation = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_crop_rotation
							}
						}
						add_innovation = innovation_crop_rotation
					}
					else = {
						remove_innovation = innovation_crop_rotation
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_crop_rotation
						}
					}
					add_innovation = innovation_crop_rotation
				}
				else = {
					remove_innovation = innovation_crop_rotation
				}		
			}
		}
	}
}

### City Planning
DI_present_innovation_city_planning = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_city_planning
							}
						}
						add_innovation = innovation_city_planning
					}
					else = {
						remove_innovation = innovation_city_planning
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_city_planning
						}
					}
					add_innovation = innovation_city_planning
				}
				else = {
					remove_innovation = innovation_city_planning
				}		
			}
		}
	}
}

### Casus Belli
DI_present_innovation_casus_belli = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_casus_belli
							}
						}
						add_innovation = innovation_casus_belli
					}
					else = {
						remove_innovation = innovation_casus_belli
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_casus_belli
						}
					}
					add_innovation = innovation_casus_belli
				}
				else = {
					remove_innovation = innovation_casus_belli
				}		
			}
		}
	}
}

### Plenary Assemblies
DI_present_innovation_plenary_assemblies = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_plenary_assemblies
							}
						}
						add_innovation = innovation_plenary_assemblies
					}
					else = {
						remove_innovation = innovation_plenary_assemblies
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_plenary_assemblies
						}
					}
					add_innovation = innovation_plenary_assemblies
				}
				else = {
					remove_innovation = innovation_plenary_assemblies
				}		
			}
		}
	}
}

### Ledger
DI_present_innovation_ledger = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_ledger
							}
						}
						add_innovation = innovation_ledger
					}
					else = {
						remove_innovation = innovation_ledger
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_ledger
						}
					}
					add_innovation = innovation_ledger
				}
				else = {
					remove_innovation = innovation_ledger
				}		
			}
		}
	}
}

### Early Medieval Local Innovation Selection
### Battlements
DI_present_innovation_battlements = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_battlements
							}
						}
						add_innovation = innovation_battlements
					}
					else = {
						remove_innovation = innovation_battlements
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_battlements
						}
					}
					add_innovation = innovation_battlements
				}
				else = {
					remove_innovation = innovation_battlements
				}
			}
		}
	}
}

### Mangonel
DI_present_innovation_mangonel = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_mangonel
							}
						}
						add_innovation = innovation_mangonel
					}
					else = {
						remove_innovation = innovation_mangonel
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_mangonel
						}
					}
					add_innovation = innovation_mangonel
				}
				else = {
					remove_innovation = innovation_mangonel
				}
			}
		}
	}
}

### Burhs
DI_present_innovation_burhs = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_burhs
							}
						}
						add_innovation = innovation_burhs
					}
					else = {
						remove_innovation = innovation_burhs
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_burhs
						}
					}
					add_innovation = innovation_burhs
				}
				else = {
					remove_innovation = innovation_burhs
				}
			}
		}
	}
}

### House Soldiers
DI_present_innovation_house_soldiers = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_house_soldiers
							}
						}
						add_innovation = innovation_house_soldiers
					}
					else = {
						remove_innovation = innovation_house_soldiers
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_house_soldiers
						}
					}
					add_innovation = innovation_house_soldiers
				}
				else = {
					remove_innovation = innovation_house_soldiers
				}
			}
		}
	}
}

### Horseshoes
DI_present_innovation_horseshoes = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_horseshoes
							}
						}
						add_innovation = innovation_horseshoes
					}
					else = {
						remove_innovation = innovation_horseshoes
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_horseshoes
						}
					}
					add_innovation = innovation_horseshoes
				}
				else = {
					remove_innovation = innovation_horseshoes
				}
			}
		}
	}
}

### Arched Saddle
DI_present_innovation_arched_saddle = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_arched_saddle
							}
						}
						add_innovation = innovation_arched_saddle
					}
					else = {
						remove_innovation = innovation_arched_saddle
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_arched_saddle
						}
					}
					add_innovation = innovation_arched_saddle
				}
				else = {
					remove_innovation = innovation_arched_saddle
				}
			}
		}
	}
}

### Hereditary Rule
DI_present_innovation_hereditary_rule = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_hereditary_rule
							}
						}
						add_innovation = innovation_hereditary_rule
					}
					else = {
						remove_innovation = innovation_hereditary_rule
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_hereditary_rule
						}
					}
					add_innovation = innovation_hereditary_rule
				}
				else = {
					remove_innovation = innovation_hereditary_rule
				}
			}
		}
	}
}

### Manroialism
DI_present_innovation_manorialism = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_manorialism
							}
						}
						add_innovation = innovation_manorialism
					}
					else = {
						remove_innovation = innovation_manorialism
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_manorialism
						}
					}
					add_innovation = innovation_manorialism
				}
				else = {
					remove_innovation = innovation_manorialism
				}
			}
		}
	}
}

### Communal Government
DI_present_innovation_development_02 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_development_02
							}
						}
						add_innovation = innovation_development_02
					}
					else = {
						remove_innovation = innovation_development_02
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_development_02
						}
					}
					add_innovation = innovation_development_02
				}
				else = {
					remove_innovation = innovation_development_02
				}
			}
		}
	}
}

### Coinage
DI_present_innovation_currency_02 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_currency_02
							}
						}
						add_innovation = innovation_currency_02
					}
					else = {
						remove_innovation = innovation_currency_02
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_currency_02
						}
					}
					add_innovation = innovation_currency_02
				}
				else = {
					remove_innovation = innovation_currency_02
				}
			}
		}
	}
}

### Royal Prerogative
DI_present_innovation_royal_prerogative = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_royal_prerogative
							}
						}
						add_innovation = innovation_royal_prerogative
					}
					else = {
						remove_innovation = innovation_royal_prerogative
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_royal_prerogative
						}
					}
					add_innovation = innovation_royal_prerogative
				}
				else = {
					remove_innovation = innovation_royal_prerogative
				}
			}
		}
	}
}

### Chronicle Writing
DI_present_innovation_chronicle_writing = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_chronicle_writing
							}
						}
						add_innovation = innovation_chronicle_writing
					}
					else = {
						remove_innovation = innovation_chronicle_writing
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_chronicle_writing
						}
					}
					add_innovation = innovation_chronicle_writing
				}
				else = {
					remove_innovation = innovation_chronicle_writing
				}
			}
		}
	}
}

### Armillary Sphere
DI_present_innovation_armilary_sphere = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_armilary_sphere
							}
						}
						add_innovation = innovation_armilary_sphere
					}
					else = {
						remove_innovation = innovation_armilary_sphere
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_armilary_sphere
						}
					}
					add_innovation = innovation_armilary_sphere
				}
				else = {
					remove_innovation = innovation_armilary_sphere
				}
			}
		}
	}
}

### Baliffs
DI_present_innovation_baliffs = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_baliffs
							}
						}
						add_innovation = innovation_baliffs
					}
					else = {
						remove_innovation = innovation_baliffs
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_baliffs
						}
					}
					add_innovation = innovation_baliffs
				}
				else = {
					remove_innovation = innovation_baliffs
				}
			}
		}
	}
}

### High Medieval Local Innovation Selection
### Hoardings
DI_present_innovation_hoardings = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_hoardings
							}
						}
						add_innovation = innovation_hoardings
					}
					else = {
						remove_innovation = innovation_hoardings
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_hoardings
						}
					}
					add_innovation = innovation_hoardings
				}
				else = {
					remove_innovation = innovation_hoardings
				}			
			}
		}
	}
}

### Trebuchet
DI_present_innovation_trebuchet = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_trebuchet
							}
						}
						add_innovation = innovation_trebuchet
					}
					else = {
						remove_innovation = innovation_trebuchet
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_trebuchet
						}
					}
					add_innovation = innovation_trebuchet
				}
				else = {
					remove_innovation = innovation_trebuchet
				}			
			}
		}
	}
}

### Castle Baileys
DI_present_innovation_castle_baileys = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_castle_baileys
							}
						}
						add_innovation = innovation_castle_baileys
					}
					else = {
						remove_innovation = innovation_castle_baileys
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_castle_baileys
						}
					}
					add_innovation = innovation_castle_baileys
				}
				else = {
					remove_innovation = innovation_castle_baileys
				}			
			}
		}
	}
}

### Men at Arms
DI_present_innovation_men_at_arms = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_men_at_arms
							}
						}
						add_innovation = innovation_men_at_arms
					}
					else = {
						remove_innovation = innovation_men_at_arms
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_men_at_arms
						}
					}
					add_innovation = innovation_men_at_arms
				}
				else = {
					remove_innovation = innovation_men_at_arms
				}		
			}
		}
	}
}

### Knighthood
DI_present_innovation_knighthood = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_knighthood
							}
						}
						add_innovation = innovation_knighthood
					}
					else = {
						remove_innovation = innovation_knighthood
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_knighthood
						}
					}
					add_innovation = innovation_knighthood
				}
				else = {
					remove_innovation = innovation_knighthood
				}		
			}
		}
	}
}

### Advanced Bowmaking
DI_present_innovation_advanced_bowmaking = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_advanced_bowmaking
							}
						}
						add_innovation = innovation_advanced_bowmaking
					}
					else = {
						remove_innovation = innovation_advanced_bowmaking
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_advanced_bowmaking
						}
					}
					add_innovation = innovation_advanced_bowmaking
				}
				else = {
					remove_innovation = innovation_advanced_bowmaking
				}		
			}
		}
	}
}

### Heraldry
DI_present_innovation_heraldry = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_heraldry
							}
						}
						add_innovation = innovation_heraldry
					}
					else = {
						remove_innovation = innovation_heraldry
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_heraldry
						}
					}
					add_innovation = innovation_heraldry
				}
				else = {
					remove_innovation = innovation_heraldry
				}		
			}
		}
	}
}

### Windmills
DI_present_innovation_windmills = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_windmills
							}
						}
						add_innovation = innovation_windmills
					}
					else = {
						remove_innovation = innovation_windmills
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_windmills
						}
					}
					add_innovation = innovation_windmills
				}
				else = {
					remove_innovation = innovation_windmills
				}		
			}
		}
	}
}

### Divine Right
DI_present_innovation_divine_right = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_divine_right
							}
						}
						add_innovation = innovation_divine_right
					}
					else = {
						remove_innovation = innovation_divine_right
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_divine_right
						}
					}
					add_innovation = innovation_divine_right
				}
				else = {
					remove_innovation = innovation_divine_right
				}		
			}
		}
	}
}

### Land Grants
DI_present_innovation_land_grants = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_land_grants
							}
						}
						add_innovation = innovation_land_grants
					}
					else = {
						remove_innovation = innovation_land_grants
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_land_grants
						}
					}
					add_innovation = innovation_land_grants
				}
				else = {
					remove_innovation = innovation_land_grants
				}		
			}
		}
	}
}

### Scutage
DI_present_innovation_scutage = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_scutage
							}
						}
						add_innovation = innovation_scutage
					}
					else = {
						remove_innovation = innovation_scutage
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_scutage
						}
					}
					add_innovation = innovation_scutage
				}
				else = {
					remove_innovation = innovation_scutage
				}		
			}
		}
	}
}

### Guilds
DI_present_innovation_guilds = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_guilds
							}
						}
						add_innovation = innovation_guilds
					}
					else = {
						remove_innovation = innovation_guilds
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_guilds
						}
					}
					add_innovation = innovation_guilds
				}
				else = {
					remove_innovation = innovation_guilds
				}		
			}
		}
	}
}

### Urbanization
DI_present_innovation_development_03 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_development_03
							}
						}
						add_innovation = innovation_development_03
					}
					else = {
						remove_innovation = innovation_development_03
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_development_03
						}
					}
					add_innovation = innovation_development_03
				}
				else = {
					remove_innovation = innovation_development_03
				}
			}
		}
	}
}

### Banking
DI_present_innovation_currency_03 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_currency_03
							}
						}
						add_innovation = innovation_currency_03
					}
					else = {
						remove_innovation = innovation_currency_03
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_currency_03
						}
					}
					add_innovation = innovation_currency_03
				}
				else = {
					remove_innovation = innovation_currency_03
				}
			}
		}
	}
}

### Late Medieval Local Innovation Selection
### machicolations
DI_present_innovation_machicolations = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_machicolations
							}
						}
						add_innovation = innovation_machicolations
					}
					else = {
						remove_innovation = innovation_machicolations
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_machicolations
						}
					}
					add_innovation = innovation_machicolations
				}
				else = {
					remove_innovation = innovation_machicolations
				}
			}
		}
	}
}

### Bombard
DI_present_innovation_bombard = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_bombard
							}
						}
						add_innovation = innovation_bombard
					}
					else = {
						remove_innovation = innovation_bombard
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_bombard
						}
					}
					add_innovation = innovation_bombard
				}
				else = {
					remove_innovation = innovation_bombard
				}
			}
		}
	}
}

### Royal Armory
DI_present_innovation_royal_armory = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_royal_armory
							}
						}
						add_innovation = innovation_royal_armory
					}
					else = {
						remove_innovation = innovation_royal_armory
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_royal_armory
						}
					}
					add_innovation = innovation_royal_armory
				}
				else = {
					remove_innovation = innovation_royal_armory
				}
			}
		}
	}
}

### Standing Armies
DI_present_innovation_standing_armies = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_standing_armies
							}
						}
						add_innovation = innovation_standing_armies
					}
					else = {
						remove_innovation = innovation_standing_armies
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_standing_armies
						}
					}
					add_innovation = innovation_standing_armies
				}
				else = {
					remove_innovation = innovation_standing_armies
				}
			}
		}
	}
}

### Sappers
DI_present_innovation_sappers = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_sappers
							}
						}
						add_innovation = innovation_sappers
					}
					else = {
						remove_innovation = innovation_sappers
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_sappers
						}
					}
					add_innovation = innovation_sappers
				}
				else = {
					remove_innovation = innovation_sappers
				}
			}
		}
	}
}

### Plate Armor
DI_present_innovation_plate_armor = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_plate_armor
							}
						}
						add_innovation = innovation_plate_armor
					}
					else = {
						remove_innovation = innovation_plate_armor
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_plate_armor
						}
					}
					add_innovation = innovation_plate_armor
				}
				else = {
					remove_innovation = innovation_plate_armor
				}
			}
		}
	}
}

### Primogeniture Rule
DI_present_innovation_primogeniture = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_primogeniture
							}
						}
						add_innovation = innovation_primogeniture
					}
					else = {
						remove_innovation = innovation_primogeniture
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_primogeniture
						}
					}
					add_innovation = innovation_primogeniture
				}
				else = {
					remove_innovation = innovation_primogeniture
				}
			}
		}
	}
}

### Cranes
DI_present_innovation_cranes = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_cranes
							}
						}
						add_innovation = innovation_cranes
					}
					else = {
						remove_innovation = innovation_cranes
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_cranes
						}
					}
					add_innovation = innovation_cranes
				}
				else = {
					remove_innovation = innovation_cranes
				}
			}
		}
	}
}

### Noblesse Oblige
DI_present_innovation_noblesse_oblige = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_noblesse_oblige
							}
						}
						add_innovation = innovation_noblesse_oblige
					}
					else = {
						remove_innovation = innovation_noblesse_oblige
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = { 
					limit = {
						NOT = {
							has_innovation = innovation_noblesse_oblige
						}
					}
					add_innovation = innovation_noblesse_oblige
				}
				else = {
					remove_innovation = innovation_noblesse_oblige
				}
			}
		}
	}
}

### Rightful Ownership
DI_present_innovation_rightful_ownership = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_rightful_ownership
							}
						}
						add_innovation = innovation_rightful_ownership
					}
					else = {
						remove_innovation = innovation_rightful_ownership
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_rightful_ownership
						}
					}
					add_innovation = innovation_rightful_ownership
				}
				else = {
					remove_innovation = innovation_rightful_ownership
				}								
			}
		}
	}
}

### Ermine CLoaks
DI_present_innovation_ermine_cloaks = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_ermine_cloaks
							}
						}
						add_innovation = innovation_ermine_cloaks
					}
					else = {
						remove_innovation = innovation_ermine_cloaks
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_ermine_cloaks
						}
					}
					add_innovation = innovation_ermine_cloaks
				}
				else = {
					remove_innovation = innovation_ermine_cloaks
				}								
			}
		}
	}
}

### Court Officials
DI_present_innovation_court_officials = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_court_officials
							}
						}
						add_innovation = innovation_court_officials
					}
					else = {
						remove_innovation = innovation_court_officials
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_court_officials
						}
					}
					add_innovation = innovation_court_officials
				}
				else = {
					remove_innovation = innovation_court_officials
				}								
			}
		}
	}
}

### Renaissance Thought
DI_present_innovation_development_04 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_development_04
							}
						}
						add_innovation = innovation_development_04
					}
					else = {
						remove_innovation = innovation_development_04
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_development_04
						}
					}
					add_innovation = innovation_development_04
				}
				else = {
					remove_innovation = innovation_development_04
				}								
			}
		}
	}
}

### Promissory Notes
DI_present_innovation_currency_04 = {
	scope = character

	effect = {
		save_scope_as = root_target
		random_owned_story = {
			limit = {
				story_type = DI_misc_variables_story
			}
			save_scope_as = DI_story
		}
		
		if = {
			limit = {
				scope:DI_story = { has_variable = DI_pinned_char_var }
			}
			every_living_character = {
				limit = {
					has_character_flag = pinned_for_edit
				}
				save_scope_as = target
				
				scope:target.culture = {
					if = {
						limit = {
							NOT = {
								has_innovation = innovation_currency_04
							}
						}
						add_innovation = innovation_currency_04
					}
					else = {
						remove_innovation = innovation_currency_04
					}								
				}
			}
		}
		else = {
			scope:root_target.culture = {
				if = {
					limit = {
						NOT = {
							has_innovation = innovation_currency_04
						}
					}
					add_innovation = innovation_currency_04
				}
				else = {
					remove_innovation = innovation_currency_04
				}								
			}
		}
	}
}

### Present Laws ###
DI_ce_gender_equality = {
	scope = character # Player

	effect = {
		save_scope_as = player

		scope:player.faith = {
			## DOCTRINE_GENDER
			if = {
				limit = { has_doctrine = doctrine_gender_male_dominated }
				remove_doctrine = doctrine_gender_male_dominated
			}
			else_if = {
				limit = { has_doctrine = doctrine_gender_female_dominated }
				remove_doctrine = doctrine_gender_female_dominated
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_gender_equal } }
				add_doctrine = doctrine_gender_equal
			}

			## DOCTRINE_CLERICAL_GENDER
			if = {
				limit = { has_doctrine = doctrine_clerical_gender_male_only }
				remove_doctrine = doctrine_clerical_gender_male_only
			}
			else_if = {
				limit = { has_doctrine = doctrine_clerical_gender_female_only }
				remove_doctrine = doctrine_clerical_gender_female_only
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_clerical_gender_either } }
				add_doctrine = doctrine_clerical_gender_either
			}


			## DOCTRINE_ADULTERY_MEN & DOCTRINE_ADULTERY_WOMEN
			#Makes the adultery doctrine same for both genders (picks lesser version)

			#Any of them accepted? Both should be accepted
			if = {
				limit = {
					OR = {
						has_doctrine = doctrine_adultery_men_accepted
						has_doctrine = doctrine_adultery_women_accepted
					}
				}

				#Is male wrong?
				if = {
					limit = { NOT = { has_doctrine = doctrine_adultery_men_accepted } }

					if = {
						limit = { has_doctrine = doctrine_adultery_men_crime }
						remove_doctrine = doctrine_adultery_men_crime
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_men_shunned }
						remove_doctrine = doctrine_adultery_men_shunned
					}
					add_doctrine = doctrine_adultery_men_accepted
				}

				#Is female wrong?
				if = {
					limit = { NOT = { has_doctrine = doctrine_adultery_women_accepted } }

					if = {
						limit = { has_doctrine = doctrine_adultery_women_crime }
						remove_doctrine = doctrine_adultery_women_crime
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_women_shunned }
						remove_doctrine = doctrine_adultery_women_shunned
					}
					add_doctrine = doctrine_adultery_women_accepted
				}
			}
			##Any of them shunned? Both should be shunned
			else_if = {
				limit = {
					OR = {
						has_doctrine = doctrine_adultery_men_shunned
						has_doctrine = doctrine_adultery_women_shunned
					}
				}

				#Is male wrong?
				if = {
					limit = { NOT = { has_doctrine = doctrine_adultery_men_shunned } }
					remove_doctrine = doctrine_adultery_men_crime
					add_doctrine = doctrine_adultery_men_shunned
				}

				#Is female wrong?
				if = {
					limit = { NOT = { has_doctrine = doctrine_adultery_women_shunned } }
					remove_doctrine = doctrine_adultery_women_crime
					add_doctrine = doctrine_adultery_women_shunned
				}
			}
			##Else: they're both criminal, nothing to do here
		}

		if = {
			limit = {
				OR = {
					has_realm_law = male_preference_law
					has_realm_law = female_preference_law
					has_realm_law = female_only_law
					has_realm_law = male_only_law
				}
			}
			add_realm_law = equal_law
		}

		scope:player.culture = {
			if = {
				limit = {
					OR = {
						has_cultural_pillar = martial_custom_male_only
						has_cultural_pillar = martial_custom_female_only
					}
				}
				set_culture_pillar = martial_custom_equal
			}
		}
	}
}

DI_ce_inverse_genders = {
	scope = character # Player

	effect = {
		save_scope_as = player

		scope:player.faith = {
			## DOCTRINE_GENDER
			if = {
				limit = { has_doctrine = doctrine_gender_male_dominated }
				remove_doctrine = doctrine_gender_male_dominated
				add_doctrine = doctrine_gender_female_dominated
			}
			else_if = {
				limit = { has_doctrine = doctrine_gender_female_dominated }
				remove_doctrine = doctrine_gender_female_dominated
				add_doctrine = doctrine_gender_male_dominated
			}
			#Else: equal, do nothing

			## DOCTRINE_CLERICAL_GENDER
			if = {
				limit = { has_doctrine = doctrine_clerical_gender_male_only }
				remove_doctrine = doctrine_clerical_gender_male_only
				add_doctrine = doctrine_clerical_gender_female_only
			}
			else_if = {
				limit = { has_doctrine = doctrine_clerical_gender_female_only }
				remove_doctrine = doctrine_clerical_gender_female_only
				add_doctrine = doctrine_clerical_gender_male_only
			}
			#Else: either, do nothing

			## DOCTRINE_ADULTERY_MEN & DOCTRINE_ADULTERY_WOMEN
			# Men and women swap doctrine
			if = {
				limit = {
					NOR = {
						AND = {
							has_doctrine = doctrine_adultery_women_accepted
							has_doctrine = doctrine_adultery_men_accepted
						}
						AND = {
							has_doctrine = doctrine_adultery_women_shunned
							has_doctrine = doctrine_adultery_men_shunned
						}
						AND = {
							has_doctrine = doctrine_adultery_women_crime
							has_doctrine = doctrine_adultery_men_crime
						}
					}
				}
				# Save women's doctrine
				if = {
					limit = { has_doctrine = doctrine_adultery_women_accepted }
					save_scope_value_as = {
						name = doctrine_adultery_women
						value = flag:doctrine_adultery_women_accepted
					}
				}
				else_if = {
					limit = {  has_doctrine = doctrine_adultery_women_shunned }
					save_scope_value_as = {
						name = doctrine_adultery_women
						value = flag:doctrine_adultery_women_shunned
					}
				}
				else_if = {
					limit = {  has_doctrine = doctrine_adultery_women_crime }
					save_scope_value_as = {
						name = doctrine_adultery_women
						value = flag:doctrine_adultery_women_crime
					}
				}

				# Give women mens' doctrine
				if = {
					limit = { has_doctrine = doctrine_adultery_men_accepted }
					if = {
						limit = { has_doctrine = doctrine_adultery_women_shunned }
						remove_doctrine = doctrine_adultery_women_shunned
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_women_crime }
						remove_doctrine = doctrine_adultery_women_crime
					}
					add_doctrine = doctrine_adultery_women_accepted
				}
				else_if = {
					limit = { has_doctrine = doctrine_adultery_men_shunned }
					if = {
						limit = { has_doctrine = doctrine_adultery_women_accepted }
						remove_doctrine = doctrine_adultery_women_accepted
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_women_crime }
						remove_doctrine = doctrine_adultery_women_crime
					}
					add_doctrine = doctrine_adultery_women_shunned
				}
				else_if = {
					limit = { has_doctrine = doctrine_adultery_men_crime }
					if = {
						limit = { has_doctrine = doctrine_adultery_women_accepted }
						remove_doctrine = doctrine_adultery_women_accepted
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_women_shunned }
						remove_doctrine = doctrine_adultery_women_shunned
					}
					add_doctrine = doctrine_adultery_women_crime
				}

				# Give men women' doctrine
				if = {
					limit = { scope:doctrine_adultery_women = flag:doctrine_adultery_women_accepted }
					if = {
						limit = { has_doctrine = doctrine_adultery_men_shunned }
						remove_doctrine = doctrine_adultery_men_shunned
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_men_crime }
						remove_doctrine = doctrine_adultery_men_crime
					}
					add_doctrine = doctrine_adultery_men_accepted
				}
				else_if = {
					limit = { scope:doctrine_adultery_women = flag:doctrine_adultery_women_shunned }
					if = {
						limit = { has_doctrine = doctrine_adultery_men_accepted }
						remove_doctrine = doctrine_adultery_men_accepted
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_men_crime }
						remove_doctrine = doctrine_adultery_men_crime
					}
					add_doctrine = doctrine_adultery_men_shunned
				}
				else_if = {
					limit = { scope:doctrine_adultery_women = flag:doctrine_adultery_women_crime }
					if = {
						limit = { has_doctrine = doctrine_adultery_men_accepted }
						remove_doctrine = doctrine_adultery_men_accepted
					}
					else_if = {
						limit = { has_doctrine = doctrine_adultery_men_shunned }
						remove_doctrine = doctrine_adultery_men_shunned
					}
					add_doctrine = doctrine_adultery_men_crime
				}
			}
		}

		# Take care of any titles with their own title laws.
		every_held_title = {
			limit = { can_title_have_law_general_trigger = yes }
			# Invert male-only.
			if = {
				limit = { has_title_law = male_only_law }
				remove_title_law = male_only_law
				add_title_law = female_only_law
			}
			# Invert female-only.
			else_if = {
				limit = { has_title_law = female_only_law }
				remove_title_law = female_only_law
				add_title_law = male_only_law
			}
		}
		# Now realm law.
		if = {
			limit = { has_realm_law = male_only_law }
			add_realm_law = female_only_law
			if = {
				limit = {
					highest_held_title_tier >= tier_county
					is_male = yes
					is_ai = yes
					any_heir = { is_female = yes }
				}
				depose = yes
			}
		}
		else_if = {
			limit = { has_realm_law = male_preference_law }
			add_realm_law = female_preference_law
			if = {
				limit = {
					highest_held_title_tier >= tier_county
					is_male = yes
					is_ai = yes
					any_heir = { is_female = yes }
				}
				depose = yes
			}
		}
		else_if = {
			limit = { has_realm_law = female_preference_law }
			add_realm_law = male_preference_law
			if = {
				limit = {
					highest_held_title_tier >= tier_county
					is_female = yes
					is_ai = yes
					any_heir = { is_male = yes }
				}
				depose = yes
			}
		}
		else_if = {
			limit = { has_realm_law = female_only_law }
			add_realm_law = male_only_law
			if = {
				limit = {
					highest_held_title_tier >= tier_county
					is_female = yes
					is_ai = yes
					any_heir = { is_male = yes }
				}
				depose = yes
			}
		}
		#Else: equal, nothing changes

		scope:player.faith = {
			if = {
				limit = {
					has_doctrine = doctrine_clerical_gender_male_only
					religious_head ?= { is_female = yes }
				}
				religious_head = { depose = yes }
			}
			else_if = {
				limit = {
					has_doctrine = doctrine_clerical_gender_female_only
					religious_head ?= { is_male = yes }
				}
				religious_head = { depose = yes }
			}
		}

		scope:player.culture = {
			if = {
				limit = { has_cultural_pillar = martial_custom_male_only }
				set_culture_pillar = martial_custom_female_only
			}
			else_if = {
				limit = { has_cultural_pillar = martial_custom_female_only }
				set_culture_pillar = martial_custom_male_only
			}
		}
	}
}

DI_ce_female_dominated = {
	scope = character # Player 

	effect = {
		save_scope_as = player

		scope:player.faith = {
			## DOCTRINE_GENDER
			if = {
				limit = { has_doctrine = doctrine_gender_equal }
				remove_doctrine = doctrine_gender_equal
			}
			else_if = {
				limit = { has_doctrine = doctrine_gender_male_dominated }
				remove_doctrine = doctrine_gender_male_dominated
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_gender_female_dominated } }
				add_doctrine = doctrine_gender_female_dominated
			}

			## DOCTRINE_CLERICAL_GENDER
			if = {
				limit = { has_doctrine = doctrine_clerical_gender_male_only }
				remove_doctrine = doctrine_clerical_gender_male_only
			}
			else_if = {
				limit = { has_doctrine = doctrine_clerical_gender_either }
				remove_doctrine = doctrine_clerical_gender_either
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_clerical_gender_female_only } }
				add_doctrine = doctrine_clerical_gender_female_only
			}

			## DOCTRINE_ADULTERY_MEN & DOCTRINE_ADULTERY_WOMEN
			# Remove accepted for men, add shunned
			# Add accepted for women, remove shunned
			if = {
				limit = {
					has_doctrine = doctrine_adultery_women_shunned
				}
				remove_doctrine = doctrine_adultery_women_shunned
			}
			if = {
				limit = {
					has_doctrine = doctrine_adultery_women_crime
				}
				remove_doctrine = doctrine_adultery_women_crime
			}
			if = {
				limit = {
					NOT = {
						has_doctrine = doctrine_adultery_women_accepted
					}
				}
				add_doctrine = doctrine_adultery_women_accepted
			}
			if = {
				limit = {
					has_doctrine = doctrine_adultery_men_accepted
				}
				remove_doctrine = doctrine_adultery_men_accepted
			}
			if = {
				limit = {
					NOT = {
						has_doctrine = doctrine_adultery_men_shunned
					}
				}
				add_doctrine = doctrine_adultery_men_shunned
			}

			if = {
				limit = {
					has_doctrine = doctrine_clerical_gender_female_only
					religious_head ?= { is_male = yes }
				}
				religious_head = { depose = yes }
			}
		}

		scope:player.culture = {
			if = {
				limit = { has_cultural_pillar = martial_custom_male_only }
				set_culture_pillar = martial_custom_female_only
			}
			else_if = {
				limit = { has_cultural_pillar = martial_custom_female_only }
				set_culture_pillar = martial_custom_male_only
			}
		}

		if = {
			limit = {
				OR = {
					has_realm_law = male_preference_law
					has_realm_law = male_only_law
					has_realm_law = female_preference_law
					has_realm_law = equal_law
				}
			}
			add_realm_law = female_only_law
		}
		if = {
			limit = {
				scope:player.primary_title = title:e_hre
			}
			scope:player.primary_title = { 
				remove_title_law = male_only_law
				add_title_law = female_only_law
			}
		}

		scope:player.culture = {
			if = {
				limit = {
					OR = {
						has_cultural_pillar = martial_custom_male_only
						has_cultural_pillar = martial_custom_equal
					}
				}
				set_culture_pillar = martial_custom_female_only
			}
		}
	}
}

DI_ce_male_dominated = {
	scope = character # Player

	effect = {
		save_scope_as = player

		scope:player.faith = {
			## DOCTRINE_GENDER
			if = {
				limit = { has_doctrine = doctrine_gender_equal }
				remove_doctrine = doctrine_gender_equal
			}
			else_if = {
				limit = { has_doctrine = doctrine_gender_female_dominated }
				remove_doctrine = doctrine_gender_female_dominated
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_gender_male_dominated } }
				add_doctrine = doctrine_gender_male_dominated
			}

			## DOCTRINE_CLERICAL_GENDER
			if = {
				limit = { has_doctrine = doctrine_clerical_gender_female_only }
				remove_doctrine = doctrine_clerical_gender_female_only
			}
			else_if = {
				limit = { has_doctrine = doctrine_clerical_gender_either }
				remove_doctrine = doctrine_clerical_gender_either
			}

			if = {
				limit = { NOT = { has_doctrine = doctrine_clerical_gender_male_only } }
				add_doctrine = doctrine_clerical_gender_male_only
			}


			## DOCTRINE_ADULTERY_MEN & DOCTRINE_ADULTERY_WOMEN
			# Remove accepted for women, add shunned
			# Add accepted for men, remove shunned
			if = {
				limit = {
					has_doctrine = doctrine_adultery_men_shunned
				}
				remove_doctrine = doctrine_adultery_men_shunned
			}
			if = {
				limit = {
					has_doctrine = doctrine_adultery_men_crime
				}
				remove_doctrine = doctrine_adultery_men_crime
			}
			if = {
				limit = {
					NOT = {
						has_doctrine = doctrine_adultery_men_accepted
					}
				}
				add_doctrine = doctrine_adultery_men_accepted
			}
			if = {
				limit = {
					has_doctrine = doctrine_adultery_women_accepted
				}
				remove_doctrine = doctrine_adultery_women_accepted
			}
			if = {
				limit = {
					NOT = {
						has_doctrine = doctrine_adultery_women_shunned
					}
				}
				add_doctrine = doctrine_adultery_women_shunned
			}

			if = {
				limit = {
					has_doctrine = doctrine_clerical_gender_male_only
					religious_head ?= { is_female = yes }
				}
				religious_head = { depose = yes }
			}
		}

		if = {
			limit = {
				OR = {
					has_realm_law = male_preference_law
					has_realm_law = female_only_law
					has_realm_law = female_preference_law
					has_realm_law = equal_law
				}
			}
			add_realm_law = male_only_law
		}

		scope:player.culture = {
			if = {
				limit = {
					OR = {
						has_cultural_pillar = martial_custom_female_only
						has_cultural_pillar = martial_custom_equal
					}
				}
				set_culture_pillar = martial_custom_male_only
			}
		}
	}
}

# temporal head of faith
DI_ce_temporal_hof = {
	scope = character # Player

	effect = {
		save_scope_as = player

		scope:player.faith = {
			if = {
				limit = {
					OR = {
						has_doctrine = doctrine_clerical_succession_spiritual_fixed_appointment
						has_doctrine = doctrine_clerical_succession_spiritual_appointment
						has_doctrine = doctrine_clerical_succession_temporal_fixed_appointment
					}
				}
				if = {
					limit = {
						has_doctrine = doctrine_clerical_succession_spiritual_fixed_appointment
					}
					remove_doctrine = doctrine_clerical_succession_spiritual_fixed_appointment
				}
				else_if = {
					limit = {
						has_doctrine = doctrine_clerical_succession_spiritual_appointment
					}
					remove_doctrine = doctrine_clerical_succession_spiritual_appointment
				}
				else_if = {
					limit = {
						has_doctrine = doctrine_clerical_succession_temporal_fixed_appointment
					}
					remove_doctrine = doctrine_clerical_succession_temporal_fixed_appointment
				}
				add_doctrine = doctrine_clerical_succession_temporal_appointment
			}
			
			if = {
				limit = {
					has_doctrine = doctrine_theocracy_temporal
				}
				remove_doctrine = doctrine_theocracy_temporal
				add_doctrine = doctrine_theocracy_lay_clergy
			}

			if = {
				limit = {
					OR = {
						has_doctrine = doctrine_no_head
						has_doctrine = doctrine_spiritual_head
					}
				}
				if = {
					limit = {
						has_doctrine = doctrine_no_head
					}
					remove_doctrine = doctrine_no_head
				}
				else_if = {
					limit = {
						has_doctrine = doctrine_spiritual_head
					}
					remove_doctrine = doctrine_spiritual_head
				}
				add_doctrine = doctrine_temporal_head
			}

			if = {
				limit = {
					has_doctrine = doctrine_temporal_head
				}

				set_religious_head_title = scope:player.primary_title
			}
		}
	}
}